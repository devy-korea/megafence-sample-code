<!DOCTYPE html>
<html>
<!--
Intro Page 샘플입니다.
컨텐츠는 업무에 맞게 보완해 주세요.
코드는 TODO-XX 표시한 부분 수정해 주세요.
-->
<head>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- begin of 고객사 META TAG-->
    <meta name="robots" content="noindex,nofollow">

    <!-- TO-DO : SEO 설정이 있을경우 여기에 삽입해 주세요-->
    <!-- end of 고객사 META TAG-->


    <link href="https://dist.devy.kr/bulma/0.7.1/bulma.css" rel="stylesheet" />

    <style>
        body {
            height: 100vh;
            background-color: white;
            /*background-image: url(img/background-pc.jpg?v=1);*/
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            overflow-y: hidden;
        }

        /* remove vertical scroll bar */
        html, body {
            overflow-y: scroll; /* Ensures content can still scroll */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE & Edge */
        }

            body::-webkit-scrollbar {
                display: none; /* Chrome, Safari, Edge */
            }

        hr {
            margin: 1rem 0;
        }

        #app {
            padding: 2rem 1rem 1rem 1rem;
            width: 90%;
            max-width: 1024px;
            background-color: #ffffff;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        #loading {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 999999;
            overflow: hidden;
        }

            #loading div.content {
                position: absolute;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
            }

                #loading div.content img {
                    width: 8rem;
                    height: 8rem;
                }

        /*Mobile*/
        @media only screen and (max-width: 1024px) {
            body {
                height: 100vh;
                background-color: dimgray;
                /*background-image: url(img/background-mo.jpg?v=1);*/
                background-size: cover;
                background-position: center;
                background-repeat: no-repeat;
            }
        }
    </style>
</head>
<body>

    <div id="loading">
        <div class="content">
            <img src="img/loading.gif" />
        </div>
    </div>
    <div id="app" class="container has-text-centered">
        <div>
            <img src="https://cdn2.devy.kr/9000/img/logo.png?v=1" alt="logo" style="width:100%; max-width:20rem;">
        </div>
        <div class="notification" style="padding:1rem 0.5rem;">
            <h1 class='title'>임시 페이지 운영 안내</h1>
            <hr />

            <h1 class='is-size-5'>매크로 및 접속폭주 방지 등 안정적인 웹사이트 운영을 위한 임시 페이지입니다.</h1>
            <h1 class='is-size-5'>'홈페이지 이동하기' 버튼을 클릭하시면 홈페이지로 정상 이동 됩니다.</h1>
            <hr />
            <h1 class='is-size-5 has-text-danger'>
                데모를 위해 유입차단 기능이 매 10분 단위로 2분간(08:00 ~ 09:59) 설정되어 운영 중입니다.<br />
                해당 기간에는 업무페이지로의 이동이 차단됩니다.
            </h1>
            <hr />

            <!-- TODO-2 : 사용할 GateId를 paramter로 SET -->
            <button type="button" class="button is-danger is-large" onclick="startWebGate('3')">홈페이지 접속하기</button>

            <hr />
            <!-- 선택사항 : aws turnstile-->
            <div id="turnstile-container" class="turnstile-container"></div>
        </div>
    </div>



    <!--begin of script-->
    <script>
        // 1초후 loading 닫기
        window.setTimeout(function () {
            document.getElementById("loading").style.display = "none";
        }, 1000)

    </script>


    <!-- TO-DO : 아래 코드블럭 복사 후 TODO-1 ~ TODO-2 수정 -->
    <!-- begin of megafence -------------------------------------------->

    <!-- TODO-1 : webgate.js 경로의 9000 대신 할당된 SERVICE ID로 수정-->
    <script src="https://cdn2.devy.kr/9000/js/webgate.js"></script>
    <script src="https://dist.devy.kr/jquery/jquery-3.7.1.min.js"></script>
    <script src="https://dist.devy.kr/utils/sweetalert2-11.16.1.all.min.js"></script>
    <!--
    <script defer src="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=onloadTurnstileCallback"></script>
    -->

    <script>
        var _gateId     = ""; 
        var _nextUrl    = "";

        function WG_PageLoaded() { 
        }
        function startWebGate(gateId) {
            gateId = gateId + ""; 

            $(".button").addClass("is-loading");

            var config = {
                gateId: gateId || _gateId,          // GATE-ID
                uiMode: "BACKEND",                  // FRONTEND : 대기취소버튼 표시, BACKEND : 대기취소버튼 미표시
                topTitle: "서비스 접속 대기 중",    // 대기UI 제목
                uiShowDelay: 0 * 1000,              // 대기UI 표시 지연시간(ms)
                uiHideDelay: 2 * 1000,             // 대기 종료 후 대기UI 감추기 지연시간(ms)
                resetForce: false,                  // 대기표 강제초기화. true:실행시마다 대기표 강제발급, false:유효한 내 대기표가 있으면 사용
                customType: "",                     // UI 분기 변경 필요 시
                onSuccess: function (data) {
                    //console.log("onSuccess", data);

                    var res = $WG.lastResponse;
                    if (res.GateOperationMode == "ALERT") {
                        // 강제대기 기간인 경우 (강제대기기간은 데브와이가 관리)
                        if (res.GateOperationMessageTitle == "NOT_OPEN") {
                            $WG.setCookie("WG_TOKEN_NO", "");

                            // show alert message
                            Swal.mixin({
                              customClass: {
                                confirmButton: "button is-black",
                                cancelButton: "button is-danger"
                              },
                              buttonsStyling: false
                            })
                            .fire({
                                title: '',
                                width: 640,
                                padding: "2rem 0rem",
                                html: res.GateOperationMessageDetail.replaceAll('\n','<br/>'),
                                icon: '', //'warning',
                                confirmButtonText: '확인'
                            })
                        }
                    } else if (res.GateOperationMode == "GATE") {
                        if ($WG.getParam("NextUrl")) {
                            // NextUrl 파라미터가 있는 경우
                            var nextUrl = $WG.getParam("NextUrl");
                        } else {
                            // NextUrl 파라미터가 없는경우, GATE별 이동할 페이지를 설정합니다.
                            // TODO-2 : GATE별 이동할 페이지를 업무에 맞게 수정해 주세요
                            if (gateId == "1") {
                                // 홈페이지
                                var nextUrl = "https://demo.devy.kr/9000/backend.php";
                            } else if (gateId == "3") {
                                // 래플응모
                                var nextUrl = "https://demo.devy.kr/9000/backend_with_intro.php";
                            }
                        }
                        WG_ChangeUrl(nextUrl);
                    }
                },
                // 매크로 판정 시 처리
                onMdsDetected: function (data) { 
                    //console.log("onMdsFail", data);
                    if (typeof turnstile != "undefined" && turnstile != null) {
                        turnstile.reset();
                    }
                    var msg = "매크로 등에 의한 부정접속 시도가 감지되었습니다.\n만일 '사람인지 확인하십시오' 문구가 화면에 표시되었다면 확인란을 체크하신 후 다시 시도해 보시기 바랍니다.";
                    if (data.ResultMessage == "MDS_FAIL_BLOCKED_IP") {
                        msg = "접속 차단된 IP입니다.\n다른 IP에서 접속하거나 관리자에게 문의 주시기 바랍니다.";
                    }
                    Swal.mixin({
                        customClass: {
                            confirmButton: "button is-black",
                            cancelButton: "button is-danger"
                        },
                        buttonsStyling: false
                    }).fire({
                        title: '',
                        width: 640,
                        padding: "2rem 0rem",
                        html: msg.replaceAll('\n', '<br/>'),
                        icon: '', //'warning',
                        confirmButtonText: '확인'
                    })
                    return;
                },
                onAlert: function (data) {
                    //console.log("onAlert", data);
                    alert(res.GateOperationMessageDetail);
                },
                onWaiting: function (data) {
                    //console.log("onWaiting", data);
                },
                onFail: function (data) { // 유량제어 서비스 장애 시 처리
                    //console.log("onFail", data);
                    alert("죄송합니다. 잠시 후 다시 시도해 주세요");
                },
                onFinally: function () {
                    setTimeout(function () {
                        $(".button").removeClass("is-loading");
                    }, 1000)
                }
            };
            // call WG_StartWebGate
            WG_StartWebGate(config);
        }
    </script>
    <!-- end of megafence ---------------------------------------------->

</body>
</html>
